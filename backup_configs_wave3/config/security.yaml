# Security Configuration
# =====================
#
# Comprehensive security configuration for the Novel Engine
# production deployment with enterprise-grade protection.
#
# Professional security implementation for enterprise deployment.

# Authentication Configuration
authentication:
  enabled: true
  jwt_secret: ${JWT_SECRET:auto-generated}  # Override in production
  access_token_expire_minutes: 15
  refresh_token_expire_days: 30
  password_min_length: 8
  max_login_attempts: 5
  lockout_duration_minutes: 15
  require_email_verification: true
  enable_two_factor: false  # Optional enhancement

# Authorization Configuration
authorization:
  default_role: "reader"
  role_hierarchy:
    - "admin"
    - "moderator"
    - "creator"
    - "api_user" 
    - "reader"
    - "guest"
  
  # Role permissions mapping
  roles:
    admin:
      - "system:*"
      - "user:*"
      - "story:*"
      - "character:*"
      - "api:*"
      - "simulation:*"
    
    moderator:
      - "user:read"
      - "user:update"
      - "story:*"
      - "character:read"
      - "simulation:read"
    
    creator:
      - "story:create"
      - "story:read"
      - "story:update"
      - "character:*"
      - "simulation:*"
    
    api_user:
      - "api:access"
      - "story:read"
      - "character:read"
      - "simulation:create"
      - "simulation:read"
    
    reader:
      - "story:read"
      - "character:read"
      - "simulation:read"
    
    guest:
      - "story:read"
      - "character:read"

# Rate Limiting Configuration
rate_limiting:
  enabled: true
  strategy: "adaptive"  # token_bucket, sliding_window, fixed_window, adaptive
  
  # Global rate limits
  global:
    default:
      requests: 100
      window: 60  # seconds
    auth:
      requests: 5
      window: 300
    api:
      requests: 1000
      window: 3600
    upload:
      requests: 10
      window: 600
  
  # Endpoint-specific limits
  endpoints:
    "/api/v1/auth/login":
      requests: 5
      window: 300
    "/api/v1/auth/register":
      requests: 3
      window: 600
    "/api/v1/characters":
      requests: 50
      window: 60
    "/api/v1/stories/generate":
      requests: 10
      window: 300
    "/simulations":
      requests: 20
      window: 300
  
  # DDoS protection
  ddos_protection:
    enabled: true
    suspicious_threshold: 100
    attack_threshold: 500
    time_window: 60
    block_duration: 3600  # 1 hour

# Input Validation Configuration
input_validation:
  enabled: true
  max_input_length: 10000
  strict_mode: true
  
  # SQL injection protection
  sql_injection:
    enabled: true
    severity: "critical"
    patterns:
      - "UNION.*SELECT"
      - "INSERT.*INTO"
      - "DROP.*TABLE"
      - "DELETE.*FROM"
      - "UPDATE.*SET"
      - "EXEC|EXECUTE"
      - "ALTER.*TABLE"
      - "CREATE.*TABLE"
  
  # XSS protection
  xss_protection:
    enabled: true
    severity: "high"
    patterns:
      - "<script"
      - "javascript:"
      - "on\\w+\\s*="
      - "<iframe"
      - "<object"
      - "<embed"
  
  # Command injection protection
  command_injection:
    enabled: true
    severity: "high"
    patterns:
      - "[;&|`$()]"
      - "\\.\\.\/"
      - "cmd\\.exe"
      - "powershell"
      - "bash"

# Security Headers Configuration
security_headers:
  enabled: true
  
  # Content Security Policy
  content_security_policy:
    enabled: true
    policy: "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' wss: https:; font-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self'"
  
  # HTTP Strict Transport Security
  hsts:
    enabled: true
    max_age: 31536000  # 1 year
    include_subdomains: true
    preload: true
  
  # Other security headers
  x_frame_options: "DENY"
  x_content_type_options: "nosniff"
  x_xss_protection: "1; mode=block"
  referrer_policy: "strict-origin-when-cross-origin"
  permissions_policy: "geolocation=(), microphone=(), camera=()"

# SSL/TLS Configuration
ssl:
  enabled: false  # Set to true in production
  cert_file: "/path/to/certificate.crt"
  key_file: "/path/to/private.key"
  ca_file: "/path/to/ca.crt"  # Optional
  min_tls_version: "1.2"
  max_tls_version: "1.3"
  
  # Cipher configuration
  ciphers: "ECDHE+AESGCM:ECDHE+CHACHA20:DHE+AESGCM:DHE+CHACHA20:!aNULL:!MD5:!DSS"
  
  # Development mode (self-signed certificates)
  development:
    auto_generate: true
    domain: "localhost"
    alt_names:
      - "localhost"
      - "127.0.0.1"
      - "::1"

# Database Security Configuration
database:
  encryption_at_rest: false  # Requires additional setup
  secure_delete: true
  foreign_key_constraints: true
  journal_mode: "WAL"
  
  # Connection security
  connection_security:
    max_connections: 20
    connection_timeout: 30
    idle_timeout: 300
  
  # Backup security
  backup:
    encryption: false
    retention_days: 30
    secure_location: "/secure/backups"

# Monitoring and Logging Configuration
monitoring:
  enabled: true
  
  # Security event logging
  security_events:
    enabled: true
    log_level: "INFO"
    retention_days: 90
    
    # Events to log
    events:
      - "authentication_failure"
      - "authorization_failure"
      - "rate_limit_exceeded"
      - "input_validation_failure"
      - "ddos_attempt"
      - "suspicious_activity"
  
  # Audit logging
  audit_logging:
    enabled: true
    log_level: "INFO"
    retention_days: 365
    
    # Operations to audit
    operations:
      - "user_creation"
      - "role_assignment"
      - "permission_change"
      - "configuration_change"
      - "data_access"
      - "data_modification"

# IP Whitelist Configuration
ip_whitelist:
  enabled: true
  ranges:
    - "127.0.0.0/8"     # Localhost
    - "::1/128"         # IPv6 localhost
    - "10.0.0.0/8"      # Private network
    - "172.16.0.0/12"   # Private network
    - "192.168.0.0/16"  # Private network
  
  # Additional trusted IPs (add your specific IPs here)
  trusted_ips: []

# CORS Configuration
cors:
  enabled: true
  development:
    origins:
      - "http://localhost:3000"
      - "http://127.0.0.1:3000"
      - "http://localhost:8080"
      - "http://127.0.0.1:8080"
    credentials: true
    methods:
      - "GET"
      - "POST"
      - "PUT"
      - "DELETE"
    headers:
      - "Authorization"
      - "Content-Type"
      - "X-API-Key"
      - "X-Request-ID"
  
  production:
    origins:
      - "https://novel-engine.app"
      - "https://www.novel-engine.app"
    credentials: true
    methods:
      - "GET"
      - "POST"
      - "PUT"
      - "DELETE"
    headers:
      - "Authorization"
      - "Content-Type"
      - "X-API-Key"
      - "X-Request-ID"

# Security Testing Configuration
security_testing:
  enabled: false  # Enable for security assessments
  
  # Penetration testing mode
  pen_testing:
    enabled: false
    mock_vulnerabilities: false
    detailed_error_responses: false
  
  # Security scanning
  vulnerability_scanning:
    enabled: false
    schedule: "daily"
    notify_on_findings: true

# Compliance Configuration
compliance:
  # GDPR compliance
  gdpr:
    enabled: false
    data_retention_days: 730
    consent_required: true
    right_to_deletion: true
  
  # OWASP compliance
  owasp:
    enabled: true
    top_10_protection: true
    security_headers: true
    input_validation: true
  
  # Industry standards
  standards:
    - "OWASP Top 10"
    - "NIST Cybersecurity Framework"
    - "ISO 27001 (partial)"

# Environment-specific overrides
environments:
  development:
    authentication:
      enabled: false  # Optional for development
    rate_limiting:
      enabled: false  # Optional for development
    ssl:
      enabled: false
    monitoring:
      security_events:
        log_level: "DEBUG"
  
  staging:
    authentication:
      enabled: true
    rate_limiting:
      enabled: true
    ssl:
      enabled: true
    monitoring:
      security_events:
        log_level: "INFO"
  
  production:
    authentication:
      enabled: true
    rate_limiting:
      enabled: true
    ssl:
      enabled: true
    monitoring:
      security_events:
        log_level: "WARNING"
    input_validation:
      strict_mode: true
    security_headers:
      enabled: true